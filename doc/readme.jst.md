# Overview

A light weight set of handy tools for real world program.

Reduce the gap between different systems. Such as watch directory changes on a network file system, operate `spawn` on Windows and Linux, handle async IO api with promise, etc.

Rather than help you decide what to do, it is designed to create possibilities. Even this document is generated by nokit itself.

It's one of the core lib of [nobone](https://github.com/ysmood/nobone).

[![NPM version](https://badge.fury.io/js/nokit.svg)](http://badge.fury.io/js/nokit) [![Build Status](https://travis-ci.org/ysmood/nokit.svg)](https://travis-ci.org/ysmood/nokit) [![Build status](https://ci.appveyor.com/api/projects/status/github/ysmood/nokit?svg=true)](https://ci.appveyor.com/project/ysmood/nokit) [![Deps Up to Date](https://david-dm.org/ysmood/nokit.svg?style=flat)](https://david-dm.org/ysmood/nokit)

## Features

- All async functions will return promise.
- All functions are highly lazy designed, minimum boot time.
- Test on Node v0.11+ on Mac, Linux and Windows.
- Light weight and self-reference.

# Installation

As a lib dependency, install it locally: `npm i nokit`.

# Changelog

Goto [changelog](doc/changelog.md)

# API

### Table of Content

- #### [CLI](#cli-1)

  - [Task Manager](#task-manager)
  - [Auto-Runner](#auto-runner)
  - [Static File Server](#static-file-server)
  - [Tunnel](#tunnel)
  - [Temote TTY](#temote-tty)

- #### kit
<%= doc['lib/kit.coffee-toc'] %>

- #### proxy
<%= doc['lib/proxy.coffee-toc'] %>

- #### sse
<%= doc['lib/sse.coffee-toc'] %>

- #### [drives](#drives-2)
<%= doc['lib/drives.coffee-toc'] %>


# CLI

## Task Manager

Nokit has provided a cli tool like GNU Make. If you install it globally like this:

`npm -g i nokit`

, you can execute `no` command besides a 'nofile.js' file.

### Quick Start

Create a `nofile.js` (or `.coffee`, `.ts`, etc) at your current working directory
or any of its parents directory.

Assume your file content is:

```js
var kit = require('nokit');

/**
 * Expose a task definition function.
 * @param  {Function} task `(name, dependencies, description, isSequential, callback) => Function`
 * @param  {Function} option `(name, description, default || callback) => option`
 */
module.exports = (task, option) => {
    option('-w, --hello [world]', 'Just a test option', 'world');

    // Define a default task, and it depends on the "clean" task.
    task('default', ['clean'], 'This is a comment info', (opts) => {
        // Compose a task inside another.
        printOpts(opts);

        // Use brush.
        kit.require('brush');
        kit.log('print red words'.red);
    });

    let printOpts = task('print-opts', (opts) => { kit.logs(opts); });

    task('clean', () => {
        return kit.remove('dist');
    });

    // To add alias to a task, just use space to separate names.
    // Here 'build' and 'b' are the same task.
    task('build b', () => {
        kit.require('drives');
        return kit.warp('src/**/*.js')
        .load(kit.drives.auto 'compile')
        .run('dist');
    });

    task('sequential', ['clean', 'build'], true, () => {
        kit.log('Run clean and build sequentially.');
    });
};
```

Then you can run it in command line: `no`. Just that simple, without task
name, `no` will try to call the `default` task directly.

You can run `no -h` to display help info.

Call `no build` or `no b` to run the `build` task.

Call with option: `no build -w Life`.

Call `no a b c` to run task `a`, `b`, `c` sequentially.

For real world example, just see the [nofile](nofile.coffee?source) that nokit is using.

For more doc for the `option` goto [commander.js](https://github.com/tj/commander.js).

By default nofile only supports js, if you want nokit to support babel, you should install nokit like this:

`npm i -g nokit babel-register`

Then you should add a comment in the nofile:

```js
// nofile-pre-require: babel-register

// You can also add any others at the same time.
// nofile-pre-require: babel-polyfill
```

Same works with coffee or any other languages:

`npm i -g nokit coffee-script`

Then add comment:

```coffee
# nofile-pre-require: coffee-script/register
```


## Auto-Runner

`noe` is a dev tool to run / watch / reload program automatically. Run `noe -h` to see what you
can do with it.

For more help, run: `noe -h`.


## Static File Server

`nos` is a tool to statically serve a folder. Run `nos -h` to see what you
can do with it.

For more help, run: `nos -h`.


## Tunnel

`not` is a tcp/udp tunnel tool. For example if you want to ssh a machine behind a firewall,
you can use it to easily reverse proxy port 22 to the outside world.

For more help, run: `not -h`.

> The data is encrypted on the client, so the server can't sniff the data passed between clients,
> it acts as a router.
> Now only the tcp packet will be encrypted, upd will sent as raw data.

### Quick Start

```text
                                      a.com
      +-----------+  export port  +-----------+  connect port  +-----------+
      | Machine A +-------------->| Machine R |<---------------+ Machine B |
      +-----------+               +-----------+                +-----------+
 not -o a.com -x 8080 -n A            not -s                 not -o a.com -t A
```

Suppose A and B cannot reach each other via network directly.
But they both have tcp access to the R (`a.com`).

0. Start the relay server on R to proxy tcp/udp: `not -s`,

0. Start a proxy client on A to connect to R and export self as A: `not -o a.com -n A`

0. Start a proxy client on B to connect to R and forward tcp/udp to A: `not -o a.com -t A`

That's all you need. Now your packet to B's port 7000, will be transparently forward
to A's port 8080 through the R.

IF you want to change the default port, run `not -h` for more options.


## Temote TTY

`nor` is a cross platform remote tty tool.

For more help, run: `nor -h`.

# kit

<%= doc['lib/kit.coffee'] %>


# proxy

<%= doc['lib/proxy.coffee'] %>


# sse

<%= doc['lib/sse.coffee'] %>


# drives

## Quick Start

Here it will automatically lint, compile, compress and cache files by their extensions. You can goto Drives section to see what extensions are supported,
or write your own.

```js
let kit = require('nokit');
let drives = kit.require('drives');

kit.warp('src/**/*.@(jade|less|coffee|ls)')
    // // To disable cache.
    // .load drives.reader isCache: false
    .load(drives.auto('lint'))
    .load(drives.auto('compile', { '.coffee': { bare: false } }))
    .load(drives.auto('compress'))
    .load(concat('main.js'))
.run('dist/path');
```

### Write your own drives

Nokit has already provided some handy example drives, you
can check them in the Drives section. It's fairly easy to
write your own.

```js
let kit = require('nokit');
let coffee = require('coffee-script');

// A drive for coffee, a simple curried function.
let compiler = (opts) => function () {
    // Change extension from '.coffee' to '.js'.
    this.dest.ext = '.js';
    this.set(coffee.compile(this.contents, opts));
};

// A drive to prepend lisence to each file.
// Here "fileInfo.set" is the same with the "@set".
let lisencer = (lisence) => function (fileInfo) {
    this.set(lisence + '\n' + this.contents)
}

// A drive to concat all files. It will override the default writer.
let concat = (outputFile) => {
    let all = '';

    // Object.assign
    return kit._.assign(function () {
        all += this.contents;
    }, { isWriter: true, onEnd: function () {
        // This will enable the auto-cache.
        this.deps = kit._.pluck(this.list, 'path');

        this.dest = this.to + '/' + outputFile;
        this.set(all);

        // Call the overrided writer.
        // Call two times and create two output files.
        this.super().then(() => {
            this.dest = this.dest + '.info';
            this.set = '/* info */\n' + all;
            this.super();
        });
    } });
};

kit.warp('src/**/*.coffee')
    .load(compiler(bare: true))
    .load(lisencer('/* MIT lisence */'))
    .load(concat('bundle.js'))
.run('dist')
.then(() => {
    kit.log('Build Done');
});
```

<%= doc['lib/drives.coffee'] %>

# Contribution

## Unit Test

`npm test`
or `npm run no -- test`

## Others

Run `npm run no -- -h` for all command you can use.
Such as run `npm run no -- build` to build this project.

## Docs

Edit the templete of the readme at `doc/readme.jst.md`.

# Lisence

MIT