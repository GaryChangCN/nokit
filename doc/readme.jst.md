# Overview

A light weight set of handy tools for real world program.

Reduce the gap between different systems. Such as watch directory changes on a network file system, operate `spawn` on Windows and Linux, handle async IO api with promise, etc.

Rather than help you decide what to do, it is designed to create possibilities. Even this document is generated by nokit itself.

It's one of the core lib of [nobone](https://github.com/ysmood/nobone).

[![NPM version](https://badge.fury.io/js/nokit.svg)](http://badge.fury.io/js/nokit) [![Build Status](https://travis-ci.org/ysmood/nokit.svg)](https://travis-ci.org/ysmood/nokit) [![Build status](https://ci.appveyor.com/api/projects/status/github/ysmood/nokit?svg=true)](https://ci.appveyor.com/project/ysmood/nokit) [![Deps Up to Date](https://david-dm.org/ysmood/nokit.svg?style=flat)](https://david-dm.org/ysmood/nokit)

## Features

- All async functions will return promise.
- All functions are highly lazy designed, minimum boot time.
- Test on Node v0.10+ on Mac, Linux and Windows.
- Light weight and self-reference.

# Installation

As a lib dependency, install it locally: `npm i nokit`.

Nokit has provided a cli tool like GNU Make. If you install it globally like this:

`npm -g i nokit`

, then have fun with your `nofile`, it can be js, coffee, babeljs or livescript. For more information goto the `CLI` section.

## CLI

### The `no` Comamnd

By default nokit only supports js, if you want nokit to support coffee, you should install nokit like this:

`npm i -g nokit coffee-script`

Same works with babeljs:

`npm i -g nokit babel-core babel-polyfill`

> Remarks: for the sake of boot performance, nokit will only try to load
> `babel-register`, `ts-node/register` and `coffee-script/register`
> by default. For livescript or other precompiler, you have to
> set environment varialbe `nokitPreload` to what you want, such as on unix:
> `export nokitPreload='livescript coffee-script/register'`. Different module
> names are separated by spaces.

Create a `nofile.coffee` (or `.js`, `.ls`) at your current working directory
or any of its parents directory. The syntax of `nofile` is almost the same as the Cakefile, only the `option`'s first argument is slightly changed.

Assume your file content is:

```js
var kit = require('nokit');

module.exports = (task, option) => {
    option('-w, --hello [world]', 'Just a test option');

    // Define a default task, and it depends on the "clean" task.
    task('default', ['clean'], 'This is a comment info', (opts) => {
        // Compose a task inside another.
        printOpts(opts);

        // Use brush.
        kit.require('brush');
        kit.log('print red words'.red);
    });

    let printOpts = task('print-opts', (opts) => { kit.logs(opts); });

    task('clean', () => {
        return kit.remove('dist');
    });

    // To add alias to a task, just use space to separate names.
    // Here 'build' and 'b' are the same task.
    task('build b', () => {
        kit.require('drives');
        return kit.warp('src/**/*.js')
        .load(kit.drives.auto 'compile')
        .run('dist');
    });

    task('sequential', ['clean', 'build'], true, () => {
        kit.log('Run clean and build non-concurrently.');
    });
};
```

Then you can run it in command line: `no`. Just that simple, without task
name, `no` will try to call the `default` task directly.

You can run `no -h` to display help info.

Call `no build` or `no b` to run the `build` task.

For real world example, just see the [nofile](nofile.coffee?source) that nokit is using.

For more doc for the `option` goto [commander.js](https://github.com/tj/commander.js).

### The `noe` Comamnd

`noe` is a dev tool to run / watch / reload program automatically. Run `noe -h` to see what you
can do with it.

# Changelog

Goto [changelog](doc/changelog.md)

# API

### Table of Content

- #### kit
<%= doc['lib/kit.coffee-toc'] %>

- #### proxy
<%= doc['lib/proxy.coffee-toc'] %>

- #### drives
<%= doc['lib/drives.coffee-toc'] %>

- #### sse
<%= doc['lib/sse.coffee-toc'] %>

<%= doc['lib/kit.coffee'] %>

# drives

## Quick Start

Here it will automatically lint, compile, compress and cache files by their extensions. You can goto Drives section to see what extensions are supported,
or write your own.

```js
let kit = require('nokit');
let drives = kit.require('drives');

kit.warp('src/**/*.@(jade|less|coffee|ls)')
    // // To disable cache.
    // .load drives.reader isCache: false
    .load(drives.auto('lint'))
    .load(drives.auto('compile', { '.coffee': { bare: false } }))
    .load(drives.auto('compress'))
    .load(concat('main.js'))
.run('dist/path');
```

### Write your own drives

Nokit has already provided some handy example drives, you
can check them in the Drives section. It's fairly easy to
write your own.

```js
let kit = require('nokit');
let coffee = require('coffee-script');

// A drive for coffee, a simple curried function.
let compiler = (opts) => function () {
    // Change extension from '.coffee' to '.js'.
    this.dest.ext = '.js';
    this.set(coffee.compile(this.contents, opts));
};

// A drive to prepend lisence to each file.
// Here "fileInfo.set" is the same with the "@set".
let lisencer = (lisence) => function (fileInfo) {
    this.set(lisence + '\n' + this.contents)
}

// A drive to concat all files. It will override the default writer.
let concat = (outputFile) => {
    let all = '';

    // Object.assign
    return kit._.assign(function () {
        all += this.contents;
    }, { isWriter: true, onEnd: function () {
        // This will enable the auto-cache.
        this.deps = kit._.pluck(this.list, 'path');

        this.dest = this.to + '/' + outputFile;
        this.set(all);

        // Call the overrided writer.
        // Call two times and create two output files.
        this.super().then(() => {
            this.dest = this.dest + '.info';
            this.set = '/* info */\n' + all;
            this.super();
        });
    } });
};

kit.warp('src/**/*.coffee')
    .load(compiler(bare: true))
    .load(lisencer('/* MIT lisence */'))
    .load(concat('bundle.js'))
.run('dist')
.then(() => {
    kit.log('Build Done');
});
```

<%= doc['lib/drives.coffee'] %>

# proxy

<%= doc['lib/proxy.coffee'] %>

# sse

<%= doc['lib/sse.coffee'] %>

# Contribution

## Unit Test

`npm test`
or `npm run no -- test`

## Others

Run `npm run no -- -h` for all command you can use.
Such as run `npm run no -- build` to build this project.

## Docs

Edit the templete of the readme at `doc/readme.jst.md`.

# Lisence

MIT